# 6 MONGODB AND MONGOOSE

## 6.0 Array Database part One

우리는

1. 동영상 배치

2. 선택한 영상 시청

3. 동영상 업로드, 수정

우선 가짜 DB를 만들어서 해당 기능을 구현 해보자

```js
let videos = [
  {
    title: "First Video",
    rating: 5,
    comments: 2,
    createdAt: "2 minutes ago",
    views: 59,
    id: 1,
  },
  {
    title: "Second Video",
    rating: 5,
    comments: 2,
    createdAt: "2 minutes ago",
    views: 59,
    id: 2,
  },
  {
    title: "Third Video",
    rating: 5,
    comments: 2,
    createdAt: "2 minutes ago",
    views: 59,
    id: 3,
  },
  {
    title: "Fourth Video",
    rating: 5,
    comments: 2,
    createdAt: "2 minutes ago",
    views: 59,
    id: 4,
  },
];
```

1 번은 이미 구현 했으니 2번을 해보자

```
https://localhost:4000/video/idNum
```

우리는 보고 싶은 영상을 눌러 해당 영상 주소로 가게 구현을 할꺼임

```pug
mixin video(info)
    div
        h4
            a(href=`/videos/${info.id}`)=info.title
        ul
            li #{info.rating}/5.
            li #{info.comments} comments.
            li Posted #{info.createdAt}.
            li #{info.views} views.
```

이러고 `videoController.js` 의 `see`

```js
export const see = (req, res) => {
  console.log(req.params);
  return res.render("watch");
};
```

콘솔값이

```
{ id: '1' }
GET /videos/1 200 22.436 ms - 243
```

해당 아이디값을 불러내고 있음

```js
export const see = (req, res) => {
  const { id } = req.params;
  // const id = req.params.id; 랑 같음

  const video = videos[id - 1];
  return res.render("watch", { pageTitle: `Watching ${video.title}` });
};
```

## 6.1 Array Database part Two

이제 video 정보 그대로 보내면

```js
export const see = (req, res) => {
  const { id } = req.params;
  // const id = req.params.id; 랑 같음

  const video = videos[id - 1];
  return res.render("watch", { pageTitle: `Watching ${video.title}`, video });

  //   return res.render("watch", { pageTitle: `Watching ${video.title}`, video }

  // == video: video
};
```

`watch.pug`

```pug
extends base.pug


block content
    h1=video.title

```

조건문을 이용하여 1 view 일때를 구현하면

```pug
extends base.pug


block content
    h1 #{video.views} #{video.views === 1 ? "view":"views"}
```

이제 영상 수정 페이지를 구현해보자

```pug
extends base.pug


block content
    h1 #{video.views} #{video.views === 1 ? "view":"views"}
    a(href="edit") Edit Video &rarr;
```

이렇게 하고 Edit Video 링크란을 누르면

```
http://localhost:4000/videos/edit
```

이렇게 됨 뭥미? `href="edit"` 이런데 왜 그럼?

왜 그냥 `edit`이 아니고 `/videos/edit` 임?

왜? 왜? 왜? 왜 똑똑함? 왜 알아서 함?

```
a(href="/edit")
```

이렇게 하면

```
http://localhost:4000/edit
```

이렇게 나옴

요게 바로 `absoulte, relactive url` 의 차이점

`/edit` 를 쓰면 내가 어디에 있든

root 경로 + `/edit` 으로 가게 됨

`/` 를 없애면 `relactive url` 이 되어

브라우저 현 주서에 끝부분을 바꿔 줌

그래서 이렇게 구현해주면 됨

```pug
extends base.pug


block content
    h1 #{video.views} #{video.views === 1 ? "view":"views"}
    a(href=`${video.id}/edit`) Edit Video &rarr;

```

## 6.2 Edit Video part One

이제 `edit controller` 를 만져주자

```js
export const edit = (req, res) => {
  const { id } = req.params;
  // const id = req.params.id; 랑 같음
  const video = videos[id - 1];
  // 수정할 비디오 특정 (id)

  return res.render("edit", { pageTitle: `Editing: ${video.title}` });
};
```

그리고 `edit.pug` ㄱㄱㄱ

```pug
extends base.pug


block content
    h4 Change Title of Video
    form(action="save-video")
        input(name="title" placehold="Video Title", value=video.title, required)
        input(value="Save", type="submit")
```

여기서 form의 method 방식을 기본(`GET`)으로 하고 하면

```
http://localhost:4000/videos/1/save-video?title=First+Video22
```

이런식으로 나옴

`GET` 방식은 무엇을 검색하거나 할때 해당 값이 주소창에 포함되는거

`POST` 방식은 파일을 보내거나, database에 있는 값을 바꾸는 걸 할때 사용함

```pug
extends base.pug


block content
    h4 Change Title of Video
    form(method="POST")
        input(name="title" placehold="Video Title", value=video.title, required)
        input(value="Save", type="submit")
```

`video Router.js`

```js
videoRouter.get("/:id(\\d+)/edit", getEdit);
videoRouter.post("/:id(\\d+)/edit", postEdit);
```

`videoController.js`

```js
//edit function 이름을 getEdit으로 변경
export const getEdit = (req, res) => {
  const { id } = req.params;
  // const id = req.params.id; 랑 같음
  const video = videos[id - 1];
  // 수정할 비디오 특정 (id)

  return res.render("edit", { pageTitle: `Editing: ${video.title}`, video });
};

export const postEdit = (req, res) => {};
```

근데 라우터를 보면 `get`,`post` 주소값이 같은데 오류를 내지 않고 잘 작동할까??

> 신기하데고 잘된다~ 이유는 <br>
> videoRouter.`get`("/:id(\\d+)/edit", getEdit); <br>
> videoRouter.`post`("/:id(\\d+)/edit", postEdit); <br>
> 요 `get`,`post` 로 잘 알아 먹는다~
