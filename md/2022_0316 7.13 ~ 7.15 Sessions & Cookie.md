## 7.13 Uninitialized Sessions

### resave ì™€ saveUninitialized ì˜ ì°¨ì´ì 

ì§€ê¸ˆ í˜„ì¬ ê³„ì† ìƒˆë¡œ ì ‘ì†í•˜ëŠ”ëŒ€ë¡œ ì„¸ì…˜ìœ¼ë¡œ ë°›ê³  ê·¸ê±¸ DBì— ì €ì¥ë˜ëŠ” í˜•íƒœì¸ë°

ë§Œì•½ ì´ëŸ¬í•œ ì ‘ì†ì´ ë§ì•„ì§€ë©´ DBëŠ” ë„ˆë¬´ ë§ì€ ë°ì´í„°ë¥¼ ì €ì¥í•´ì•¼í•¨

ì´ê±° ìŒ‰ ì—ë°”ì„

```js
app.use(
  session({
    secret: "hello",
    resave: false,
    saveUninitialized: false,
    store: MongoStore.create({ mongoUrl: "mongodb://127.0.0.1:27017/wetube" }),
  })
);
```

resave, saveUninitialized ë¥¼ false ë¡œ í•´ë³´ê³  í™ˆí˜ì´ì§€ì— ë“¤ì–´ê°€ë³´ì

ê·¸ëŸ¬ë©´ ì›¹ì‚¬ì´íŠ¸ê°€ ë°›ëŠ” ì¿ í‚¤ê°€ ì—†ìŒ

DB ì—­ì‹œ ë°›ì€ ë°ì´í„°ê°€ ì—†ìŒ

`resave`

    ëª¨ë“  requestë§ˆë‹¤ ì„¸ì…˜ì˜ ë³€ê²½ì‚¬í•­ì´ ìˆë“  ì—†ë“  ì„¸ì…˜ì„ ë‹¤ì‹œ ì €ì¥í•œë‹¤.

- true:

  - ìŠ¤í† ì–´ì—ì„œ ì„¸ì…˜ ë§Œë£Œì¼ìë¥¼ ì—…ë°ì´íŠ¸ í•´ì£¼ëŠ” ê¸°ëŠ¥ì´ ë”°ë¡œ ì—†ìœ¼ë©´ trueë¡œ ì„¤ì •í•˜ì—¬ ë§¤ requestë§ˆë‹¤ ì„¸ì…˜ì„ ì—…ë°ì´íŠ¸ í•´ì£¼ê²Œ í•œë‹¤.

- false:

  - ë³€ê²½ì‚¬í•­ì´ ì—†ìŒì—ë„ ì„¸ì…˜ì„ ì €ì¥í•˜ë©´ ë¹„íš¨ìœ¨ì ì´ë¯€ë¡œ ë™ì‘ íš¨ìœ¨ì„ ë†’ì´ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.
  - ê°ê° ë‹¤ë¥¸ ë³€ê²½ì‚¬í•­ì„ ìš”êµ¬í•˜ëŠ” ë‘ ê°€ì§€ requestë¥¼ ë™ì‹œì— ì²˜ë¦¬í• ë•Œ ì„¸ì…˜ì„ ì €ì¥í•˜ëŠ” ê³¼ì •ì—ì„œ ì¶©ëŒì´ ë°œìƒí•  ìˆ˜ ìˆëŠ”ë° ì´ë¥¼ ë°©ì§€í•˜ê¸°ìœ„í•´ ì‚¬ìš©í•œë‹¤.

`saveUninitialized`

    uninitialized ìƒíƒœì¸ ì„¸ì…˜ì„ ì €ì¥í•œë‹¤. ì—¬ê¸°ì„œ uninitialized ìƒíƒœì¸ ì„¸ì…˜ì´ë€ request ë•Œ ìƒì„±ëœ ì´í›„ë¡œ ì•„ë¬´ëŸ° ì‘ì—…ì´ ê°€í•´ì§€ì§€ì•ŠëŠ” ì´ˆê¸°ìƒíƒœì˜ ì„¸ì…˜ì„ ë§í•œë‹¤.

- true:

  - í´ë¼ì´ì–¸íŠ¸ë“¤ì´ ì„œë²„ì— ë°©ë¬¸í•œ ì´ íšŸìˆ˜ë¥¼ ì•Œê³ ì í• ë•Œ ì‚¬ìš©í•œë‹¤.

- false:

  - uninitialized ìƒíƒœì¸ ì„¸ì…˜ì„ ê°•ì œë¡œ ì €ì¥í•˜ë©´ ë‚´ìš©ë„ ì—†ëŠ” ë¹ˆ ì„¸ì…˜ì´ ìŠ¤í† ë¦¬ì§€ì— ê³„ì† ìŒ“ì¼ìˆ˜ ìˆë‹¤. ì´ë¥¼ ë°©ì§€, ì €ì¥ê³µê°„ì„ ì•„ë¼ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.

## 7.14 Expiration and Secrets

ì¿ í‚¤ì˜ property ì— ëŒ€í•´ ì•Œì•„ë³´ì

`Set-Cookie`

    Set-Cookie HTTP ì‘ë‹µ í—¤ë”ëŠ” ì„œë²„ì—ì„œ ì‚¬ìš©ì ë¸Œë¼ìš°ì €ì— ì¿ í‚¤ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤.

https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Set-Cookie

ì¿ í‚¤ì— ì„¤ì •ê°€ëŠ¥í•œ ì˜µì…˜

`Domain`

        ì¿ í‚¤ê°€ ì ìš©ë˜ì–´ì•¼ í•˜ëŠ” í˜¸ìŠ¤íŠ¸ë¥¼ ì§€ì •.

`Expires`

        HTTP íƒ€ì„ìŠ¤í…œí”„ë¡œ ê¸°ë¡ëœ ì¿ í‚¤ì˜ ìµœëŒ€ ìƒì¡´ ì‹œê°„(ìˆ˜ëª…).

`Max-Age`

        ì¿ í‚¤ê°€ ë§Œë£Œë  ë•Œ ê¹Œì§€ì˜ ì‹œê°„ (ë°€ë¦¬ì„¸ì»¨ë“œ)

`secret`

        ì´ê²ƒì€ ì„¸ì…˜ ID ì¿ í‚¤ì— ì„œëª…í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë¹„ë°€ì…ë‹ˆë‹¤.

https://www.npmjs.com/package/express-session

[COOKIE_SECRETì— ë„£ì„ ëœë¤ ë¬¸ìì—´ ìƒì„± ì‚¬ì´íŠ¸](https://randomkeygen.com/)

`.gitignore`

```
/node_modules
.env
```

`.env`

```
COOKIE_SECRET=ëœë¤ìƒì„±
DB_URL=mongodb://127.0.0.1:27017/wetube
```

`sesver.js`

```js
app.use(
  session({
    secret: process.env.COOKIE_SECRET,
    resave: false,
    saveUninitialized: false,
    store: MongoStore.create({ mongoUrl: process.env.DB_URL }),
  })
);
```

`db.js`

```js
mongoose.connect(process.env.DB_URL, {
  useNewUrlParser: true,
  useUnifiedTopology: true,
});
```

ì´ëŸ¬ë©´ ì´ì œ ì˜¤ë¥˜ê°€ ëœ¸

## 7.15 Environment Variables

ë°”ë¡œ `dotenv` ë€ íŒ¨í‚¤ì§€ë¥¼ ê¹”êº¼ì„

ë‚˜ì˜ env íŒŒì¼ì„ ì½ê³  ê°ê°ì˜ ë³€ìˆ˜ë“¤ì„ process.envì— ë„£ì„êº¼ì„

ê·¸ë¦¬ê³  dotenv ë¥¼ ì“´ë‹¤ê³  require í•˜ë©´ ë¨

ê·¼ë° ê·¸ëŸ¬ë©´ ë§¨ íŒŒì¼ ì•ì—

```js
require("dotenv").config();
```

í•´ì•¼í•˜ëŠ”ë° ìŒ‰ ë³„ë¡œì„

ê·¸ëŸ¬ë‹ˆ `import`ë¥¼ ì“¸êº¼ì„

ê°€ì¥ ë¨¼ì € ì‹¤í–‰ë˜ëŠ” `init.js` íŒŒì¼ ì•ì—

```js
import "dotenv/config";
import "./db";
import "./models/Video";
import "./models/User";
import app from "./server";

const PORT = 4000;

const handleListening = () =>
  console.log(`âœ… Server listenting on port http://localhost:${PORT} ğŸš€`);

app.listen(PORT, handleListening);
```

ì´ë ‡ê²Œ í•˜ë©´ ë‹¨ í•œì¤„ë¡œ ì—¬ëŸ¬ íŒŒì¼ì—ì„œ í•„ìš”í•œ env ë³€ìˆ˜ë¥¼ ì¤„ìˆ˜ ìˆìŒ

ê°œì”¹ì–´ì¸í•¨
