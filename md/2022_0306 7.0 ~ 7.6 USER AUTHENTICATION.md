# 7 USER AUTHENTICATION

## 7.0 Create Account part One

계정 생성 페이지를 만들어보자

이전에 했던걸 하면 인증부분을 추가할꺼임

`User.js`

```js
import mongoose from "mongoose";

const userSchema = new mongoose.Schema({
  email: { type: String, required: true, unique: true },
  username: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  name: { type: String, required: true },
  location: String,
});

const User = mongoose.model("User", userSchema);
export default User;
```

`init.js`

```js
import "./db";
import "./models/Video";
import "./models/User"; // User 추가
import app from "./server";

const PORT = 4000;

const handleListening = () =>
  console.log(`✅ Server listenting on port http://localhost:${PORT} 🚀`);

app.listen(PORT, handleListening);
```

`userController.js`

```js
export const join = (req, res) =>
  res.render("createAccount", { pageTitle: "Create Account" });
```

`join.pug`

```pug
extends base


block content
    form(method="post")
        input(name="name" type="text" required placeholder="name")
        input(name="email" type="email" required placeholder="email")
        input(name="username" type="text" required placeholder="username")
        input(name="password" type="password" required placeholder="passoword")
        input(name="location" type="text" placeholder="location")
        input(type="submit", value="Join")
```

## 7.1 Create Account part Two

영상 보기 귀찮다 걍 내가 혼자 만들고 나서 영상 보자

```js
import User from "../models/User";

export const postJoin = async (req, res) => {
  const { name, email, username, password, location } = req.body;

  try {
    await User.create({
      name,
      email,
      username,
      password,
      location,
    });
    return res.redirect("/login");
  } catch (error) {
    console.log(error);
    res.render("join", { pageTitle: "Join" });
  }
};
```

```shell
> db.users.find()
{ "_id" : ObjectId("6224b00cc5e0db439b49d8b0"), "email" : "dlddl@123", "username" : "안안녕", "password" : "1231", "name" : "안녕", "location" : "몰라", "__v" : 0 }
```

크 파워셀로 db 확인해보니까 잘있음 ㅋ 개쩜 ㅋ

ㅈ밥이지 ㅋ

근데 "\_\_v" 이건 뭐냐

암튼 영상이나 보러가자

니코도 똑같이 함 근데 try catch 안함

근데 보면 `password`가 그대로 노출됨

이러면 보안이 전혀 안되겠지?

그래서 `password`를 저장하기전에 보안처리를 해야함

그걸 `해싱`이라고 부름

## 7.2 Creating Account part Three

DB에 password를 저장하지 않고 해싱된 password를 저장할꺼임

해싱은 일방향 함수임

`bcrypt` 를 쓸꺼임

```
npm i bcrypt
```

```js
bcrypt.hash(myPlaintextPassword, saltRounds, function (err, hash) {
  // Store hash in your password DB.
});
```

요걸 쓸꺼임

`User.js`

```js
import bcrypt from "bcrypt";

userSchema.pre("save", async function () {
  this.password = await bcrypt.hash(this.password, 5);
});
```

이러면 된다~

## 7.3 Form Validation
