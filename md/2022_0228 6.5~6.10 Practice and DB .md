## 6.5 More Practice part One

ì´ë²ˆì—ëŠ” ë¹„ë””ì˜¤ë¥¼ upload í•˜ëŠ”ê±¸ ë§Œë“¤êº¼ì„

ê·¸ì „ì— ë‚˜ í˜¼ì í•œë²ˆ í•´ë³¼êº¼ì„

`videoRouter.js`

```js
videoRouter.route("/upload").get(getUpload).post(postUpload);
```

`videoController.js`

```js
export const uploadPost = (req, res) => {
  const { title } = req.body;
  const rating = parseInt(req.body.rating);
  const comments = parseInt(req.body.comments);
  const { createdAt } = req.body;
  const views = parseInt(req.body.views);
  const id = parseInt(req.body.id);

  videos.push({
    title: title,
    rating: rating,
    comments: comments,
    createdAt: createdAt,
    views: views,
    id: id,
  });

  return res.render("home", { pageTitle: "Home", videos });
};
```

`home.pug`

```pug
extends base
include mixins/video


block content
    h2 Welcom here you will see the trending videos
    ul
        each video in videos
            +video(video)
        else
            p Sorry nothin found.

    a(href=`videos/upload`) upload Video &rarr;

```

`upload.pug`

```pug
extends base.pug


block content
    h4 Create Video
    form(method="POST")
        input(name="title" placeholder="Title",  required)
        input(name="rating" placeholder="rating",  required)
        input(name="comments" placeholder="comments",  required)
        input(name="createdAt" placeholder="createdAt", required)
        input(name="views" placeholder="views", required)
        input(name="id" placeholder="id", required)
        input(value="Upload", type="submit")

```

ì´ë ‡ê²Œ ì™„ì„±í•¨

ì´ì œ ë‹ˆì½”ì™€ í•¨ê»˜ ë§Œë“¤ì–´ë³´ì

<br>
<br>

## 6.6 More Practice part Two

ê¸°ë³¸ì ì¸ ê³¨ìëŠ” ë‚´ê°€ í•œê±°ë‘ ë˜‘ê°™ìŒ

ê·¼ë° `upload.pug` titleë§Œ formìœ¼ë¡œ ë°›ìŒ

í™•ì‹¤íˆ íƒ€ì´í‹€ì„ ì œì™¸í•œ

rating, comments, createdAt, views, idë¥¼ ì‘ì„±í•˜ëŠ”ê²Œ

ë…¼ë¦¬ìƒ ë§ì´ ì•ˆë˜ê¸´ í•¨

ë‚œ ê± arrayì— ë„£ì„ë ¤ë©´ ì´ë˜ì•¼ì§€ í•˜ê³  ë³„ìƒê° ì—†ì´ í–ˆëŠ”ë°

êµ¬ì°Œ formì—ì„œ ë‹¤ ì‘ì„±í• ë ¤ê³  í•˜ì§€ ë§ê³ 

`postUload` founction ì•ˆì—ì„œ ì²˜ë¦¬ í•´ì£¼ë©´ ë˜ëŠ” ë¶€ë¶„ì„

`upload.pug`

```pug
extends base.pug


block content
    h3 Create Video
    form(method="POST")
        input(name="title" placeholder="Title",  required)
        input(value="Upload", type="submit"
```

`videoController.js`

```js
export const postUpload = (req, res) => {
  // here we will add a video to the videos array.
  const { title } = req.body;
  const newVideo = {
    title,
    rating: 0,
    comments: 0,
    createdAt: "just now",
    views: 0,
    id: videos.length + 1,
  };

  videos.push(newVideo);
  return res.redirect("/");
};
```

`render` ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  `redirect`ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ ë§ìŒ

`res.redirect("/")` ì´ê±¸ ì“°ë©´ ë©”ì¸í™”ë©´ìœ¼ë¡œ ê°€ì„œ ì•Œì•„ì„œ `trending` founction ì„ ì‹¤í–‰í•¨

## 6.7 Introduction to MongoDB

ì´ì œë¶€í„° ì§„ì§œ DBë¥¼ ì‚¬ìš©í•¨

ë°”ë¡œ `MongoDB`

ì–˜ì˜ íŠ¹ì§•ì€ ë°”ë¡œ `document-based` ë¼ì„œ

ì´ˆë³´ìë“¤í•œ ì¡°íƒ€~

`object` ì²˜ëŸ¼ ì“¸ ìˆ˜ ìˆë‹¤~

[chocolatey](https://community.chocolatey.org/packages/mongodb/5.2.1)

[ì°¸ê³ ì‚¬ì´íŠ¸](https://velog.io/@yl9517/window%EC%97%90%EC%84%9C-Choco-%EC%84%A4%EC%B9%98-mongoDB-%EC%84%A4%EC%B9%98)

[í™˜ê²½ë³€ìˆ˜ ë³€ê²½](https://dangphongvanthanh.wordpress.com/2017/06/12/add-mongos-bin-folder-to-the-path-environment-variable/)

<br>
<br>

## 6.8 Connecting to Mongo

ì´ë²ˆì—ëŠ” `mongoose` ì— ëŒ€í•´ ë‹¤ë¤„ë³¼êº¼ì„

`mongoose`ëŠ” `node.js`, `mongoDB`ë¥¼ ì´ì–´ì£¼ëŠ” ë‹¤ë¦¬ ì—­í™œì„ í•¨

`mongoose` ì„¤ì¹˜

```
npm i mongoose
```

ì´ì œ `mongoDB` ì™€ ì—°ê²°í• êº¼ì„

window `power shell` ì„ ì¼œì„œ

```
mongo
```

ë¥¼ ì…ë ¥í•©ë©´

```
PS C:\Users\lcw> mongo
MongoDB shell version v5.2.1
connecting to: mongodb://127.0.0.1:27017/?compressors=disabled&gssapiServiceName=mongodb
Implicit session: session { "id" : UUID("d865dc62-c23a-47b4-b928-8f9b667b94d4") }
MongoDB server version: 5.2.1

.....

```

ì´ë ‡ê²Œ ë‚˜ì˜¤ëŠ”ë° ì—¬ê¸°ì„œ `mongodb://127.0.0.1:27017/` urlë¥¼ ë³µì‚¬

`db.js`

```js
import mongoose from "mongoose";

mongoose.connect("mongodb://127.0.0.1:27017/wetube", {
  useNewUrlParser: true,
  useUnifiedTopology: true,
});
```

ë‚˜ wetubeDB ì— ì—°ê²°í•˜ê³  ì‹œí¼ìš”! í•˜ëŠ”ê±°ì„

ê·¸ë¦¬ê³  í•´ë‹¹ íŒŒì¼ì„ ê·¸ëŒ€ë¡œ `server.js`ì— import í•¨

`server.js`

```js
import "./db";
```

db ì—°ê²°ê³¼ ì˜¤ë¥˜ ì¶œë ¥ì„ ì¶”ê°€

`db.js`

```js
import mongoose from "mongoose";

mongoose.connect("mongodb://127.0.0.1:27017/wetube", {
  useNewUrlParser: true,
  useUnifiedTopology: true,
});

// db ì—°ê²°
const db = mongoose.connection;

const handleOpen = () => console.log("âœ… Connected to DB ğŸ˜");
const handleError = (error) => console.log(`âŒ DB Error ğŸ‘¿â—â— ${error}`);

// db ì— ì˜¤ë¥˜ê°€ ìƒê²¼ì„ ì‹œ í•´ë‹¹ ì˜¤ë¥˜ë¥¼ ì¶œë ¥
// on ëŠ” ì—¬ëŸ¬ë²ˆ ë°œìƒ ì‹œí‚¬ ìˆ˜ ìˆìŒ
db.on("error", handleError);

// ì—°ê²°ì´ ì„±ê³µí•˜ë©´ ì¶œë ¥
// onceëŠ” ì˜¤ì§ í•œë²ˆë§Œ ì‹¤í–‰ë¨
db.once("open", handleOpen);
```

â€» ê²½ê³ ê°€ ì•ˆëœ¸

```
  useNewUrlParser: true,
  useUnifiedTopology: true,
```

ìš”ê±¸ ì¡°ì •í•´ì„œ ë‹ˆì½”ëŠ” ê²½ê³ ë¶€ë¶„ í•´ê²°í•˜ë˜ë° ë‚œ ì•ˆëœ¸ ì™¤ê¹Œ

<br>
<br>

## 6.9 CRUD Introduction

ì DB ê°€ ì—°ê²° ëìŒ

ì´ì œ ë­˜ í• ê»€ì§€ ì•Œì•„ë³´ì

ëª©í‘œëŠ” ì„ì‹œDBë¡œ ê°’ì„ ë°›ì•„ì„œ ë§Œë“ ê²Œ ì•„ë‹Œ,

`mongoDB`ì—ì„œ ê°’ì„ ë°›ì•„ì„œ í˜ì´ì¦ˆë¥¼ ë§Œë“¤êº¼ì„

í˜ì´ì¦ˆë¥¼ ë§Œë“œëŠ”ë° ì“°ì´ëŠ” ê¸°ëŠ¥ë“¤ì„ `CRUD` ë¼ê³  ë¶ˆë¦¼

`Create Read Upload Delete`

ì´ê²ƒë“¤ì„ í• êº¼ì„

srcì— `models` í´ë” ìƒì„± ê±°ê¸°ì— `Video.js`ë¼ëŠ” íŒŒì¼ ìƒì„±

mongooseì—ê²Œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„°ê°€ ì–´ë–¤ í˜•ì‹ì¸ê°€ ì•Œë ¤ì¤˜ì•¼í•¨

## 6.10 Video Model

ì´ì œ ëª¨ë¸ì˜ í˜•ì‹ì„ ì •ì˜ í•´ë³´ì

`Video.js`

```js
import mongoose from "mongoose";

// ëª¨ë¸ì˜ í˜•íƒœ ë³´í†µ schema ë¼ê³  ê·¸ëŸ¼
const videoSchema = new mongoose.Schema({
  title: String,
  description: String,
  creationAt: Date,
  hashtag: [{ type: String }],
  meta: {
    views: Number,
    rating: Number,
  },
});
```

ì´ì œ ëª¨ë¸ì„ ë§Œë“¤êº¼ì„

`Video.js`

```js
const video = mongoose.model("Video", videoSchema);
export default video;
```

ë§Œë“  ëª¨ë¸ì„ import í•¨

`server.js`

```js
import "./models/Video";
```

ì´ë¡œì¨ `import "./db";` ë¡œ í•´ë‹¹ ì—°ê²°ì´ ì„±ê³µì ì¼ë•Œ

`import "./models/Video";` ì—ì„œ videoë¥¼ import í•´ì¤Œ

ìœ„ì˜ DB ì—°ê²°ë¡œ DBëŠ” video modelë¥¼ ì¸ì§€ í•˜ê²Œ ë˜ëŠ” ê±°

ì •ë¦¬í•˜ë©´

    DBë¥¼ mongoose ì™€ ì—°ê²°ì‹œì¼œ video model ì„ ì¸ì‹ ì‹œí‚¤ëŠ”ê±°
