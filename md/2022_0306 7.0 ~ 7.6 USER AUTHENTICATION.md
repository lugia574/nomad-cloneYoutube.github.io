# 7 USER AUTHENTICATION

## 7.0 Create Account part One

ê³„ì • ìƒì„± í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´ë³´ì

ì´ì „ì— í–ˆë˜ê±¸ í•˜ë©´ ì¸ì¦ë¶€ë¶„ì„ ì¶”ê°€í• êº¼ì„

`User.js`

```js
import mongoose from "mongoose";

const userSchema = new mongoose.Schema({
  email: { type: String, required: true, unique: true },
  username: { type: String, required: true, unique: true },
  password: { type: String, required: true },
  name: { type: String, required: true },
  location: String,
});

const User = mongoose.model("User", userSchema);
export default User;
```

`init.js`

```js
import "./db";
import "./models/Video";
import "./models/User"; // User ì¶”ê°€
import app from "./server";

const PORT = 4000;

const handleListening = () =>
  console.log(`âœ… Server listenting on port http://localhost:${PORT} ğŸš€`);

app.listen(PORT, handleListening);
```

`userController.js`

```js
export const join = (req, res) =>
  res.render("createAccount", { pageTitle: "Create Account" });
```

`join.pug`

```pug
extends base


block content
    form(method="post")
        input(name="name" type="text" required placeholder="name")
        input(name="email" type="email" required placeholder="email")
        input(name="username" type="text" required placeholder="username")
        input(name="password" type="password" required placeholder="passoword")
        input(name="location" type="text" placeholder="location")
        input(type="submit", value="Join")
```

## 7.1 Create Account part Two

ì˜ìƒ ë³´ê¸° ê·€ì°®ë‹¤ ê± ë‚´ê°€ í˜¼ì ë§Œë“¤ê³  ë‚˜ì„œ ì˜ìƒ ë³´ì

```js
import User from "../models/User";

export const postJoin = async (req, res) => {
  const { name, email, username, password, location } = req.body;

  try {
    await User.create({
      name,
      email,
      username,
      password,
      location,
    });
    return res.redirect("/login");
  } catch (error) {
    console.log(error);
    res.render("join", { pageTitle: "Join" });
  }
};
```

```shell
> db.users.find()
{ "_id" : ObjectId("6224b00cc5e0db439b49d8b0"), "email" : "dlddl@123", "username" : "ì•ˆì•ˆë…•", "password" : "1231", "name" : "ì•ˆë…•", "location" : "ëª°ë¼", "__v" : 0 }
```

í¬ íŒŒì›Œì…€ë¡œ db í™•ì¸í•´ë³´ë‹ˆê¹Œ ì˜ìˆìŒ ã…‹ ê°œì©œ ã…‹

ã…ˆë°¥ì´ì§€ ã…‹

ê·¼ë° "\_\_v" ì´ê±´ ë­ëƒ

ì•”íŠ¼ ì˜ìƒì´ë‚˜ ë³´ëŸ¬ê°€ì

ë‹ˆì½”ë„ ë˜‘ê°™ì´ í•¨ ê·¼ë° try catch ì•ˆí•¨

ê·¼ë° ë³´ë©´ `password`ê°€ ê·¸ëŒ€ë¡œ ë…¸ì¶œë¨

ì´ëŸ¬ë©´ ë³´ì•ˆì´ ì „í˜€ ì•ˆë˜ê² ì§€?

ê·¸ë˜ì„œ `password`ë¥¼ ì €ì¥í•˜ê¸°ì „ì— ë³´ì•ˆì²˜ë¦¬ë¥¼ í•´ì•¼í•¨

ê·¸ê±¸ `í•´ì‹±`ì´ë¼ê³  ë¶€ë¦„

## 7.2 Creating Account part Three

DBì— passwordë¥¼ ì €ì¥í•˜ì§€ ì•Šê³  í•´ì‹±ëœ passwordë¥¼ ì €ì¥í• êº¼ì„

í•´ì‹±ì€ ì¼ë°©í–¥ í•¨ìˆ˜ì„

`bcrypt` ë¥¼ ì“¸êº¼ì„

```
npm i bcrypt
```

```js
bcrypt.hash(myPlaintextPassword, saltRounds, function (err, hash) {
  // Store hash in your password DB.
});
```

ìš”ê±¸ ì“¸êº¼ì„

`User.js`

```js
import bcrypt from "bcrypt";

userSchema.pre("save", async function () {
  this.password = await bcrypt.hash(this.password, 5);
});
```

ì´ëŸ¬ë©´ ëœë‹¤~

## 7.3 Form Validation
