# 3. í•¨ìˆ˜

## 3.1 Node.js - ë™ê¸°ì™€ ë¹„ë™ê¸° ê·¸ë¦¬ê³  ì½œë°±

[ì¶œì²˜](https://evan-moon.github.io/2019/09/19/sync-async-blocking-non-blocking/)

ì´ì œë¶€í„° ì§„ì§œë¼ê³  í•  ìˆ˜ ìˆë‹¤

Node.jsì—ì„œ ë§¤ìš° ì¤‘ìš”í•œ íŠ¹ì§•ì¸ ë¹„ë™ê¸° ì²˜ë¦¬ ë°©ì‹ì„ ì‚´í´ë³´ì.

Node.js ì‹¤í–‰ìˆœì„œë¥¼ íŒŒì•…í•˜ëŠ” ê²ƒì´ ëª©ì 

ë™ê¸°(Synchronous)ì™€ ë¹„ë™ê¸°(asynchronous )

- ë™ê¸°

  - ë‹¨ìˆœíˆ ë™ê¸°ë¼ëŠ” ë‹¨ì–´ë¥¼ ë“¤ìœ¼ë©´ ëŒ€ë¶€ë¶„ì˜ ë¶„ë“¤ì´ ì–´ë–¤ ì‘ì—…ì´ ëë‚˜ì§€ ì•Šìœ¼ë©´ ê·¸ ë’¤ì˜ ì‘ì—…ì´ ì§„í–‰ì´ ì•ˆ ëœë‹¤ëŠ” ëŠë‚Œìœ¼ë¡œë§Œ ì•Œê³  ìˆì§€ë§Œ,

    ë™ê¸°ëŠ” ë™ì‹œì— ë˜‘ê°™ì´ ì§„í–‰ëœë‹¤ëŠ” ëœ»ì„ ê°€ì§€ê³  ìˆë‹¤.

    ì˜ˆë¥¼ ë“¤ì–´, ì•„ì´í°ì„ ë™ê¸°í™”í•œë‹¤ê³  í•˜ë©´ ì•„ì´íŠ ì¦ˆì™€ ì•„ì´í°ì´ ë™ì‹œì— ê°™ì€ ìƒíƒœë¡œ ì—…ë°ì´íŠ¸ê°€ ë˜ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ëŠ” ê²ƒì´ë‹¤.

  - ëŒ€í‘œì ì¸ ë™ê¸°ì˜ ì˜ˆë¡œëŠ” ì€í–‰ì´ ìˆë‹¤.

    ì†¡ê¸ˆì„ í•˜ê³  ê¸ˆì•¡ì„ ë°›ëŠ” ìƒí™©ì€ ë™ì‹œì— ì´ë£¨ì–´ì ¸ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

    (í•œ ìª½ì—ì„œëŠ” ëˆì„ ë³´ëƒˆì§€ë§Œ ë‹¤ë¥¸ í•œ ìª½ì—ì„œëŠ” ëˆì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒí™©ì´ ìƒê¸´ë‹¤ë©´ ì´ë¥¼ ì•…ìš©í•˜ëŠ” ì‚¬ë¡€ë“¤ì´ ë§ì„ ê²ƒì´ë‹¤)

- ë¹„ë™ê¸°

  - ë¹„ë™ê¸°ëŠ” ë™ê¸°ì˜ ë°˜ëŒ€ì´ë‹¤.

    ë¹„ë™ê¸°ëŠ” ë™ì‹œì— ë˜‘ê°™ì´ ì§„í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ëœ»ì„ ê°€ì§€ê³  ìˆë‹¤.

    ì‘ì—…ë“¤ì˜ ìš”ì²­ê³¼ ì‘ë‹µì˜ íƒ€ì´ë°ì´ ê°™ì§€ ì•Šì•„ë„ ëœë‹¤ëŠ” ê²ƒì´ë‹¤.

  - ëŒ€í‘œì ì¸ ë¹„ë™ê¸°ì˜ ì˜ˆë¡œëŠ” ì‹œí—˜ì´ ìˆë‹¤.

    í•™ìƒì€ ì‹œí—˜ì§€ë¥¼ í’€ê³  ì±„ì ì„ ê¸°ë‹¤ë¦¬ë©´ ë˜ê³ ,

    ì„ ìƒì€ ì±„ì ì„ í•˜ì—¬ í•™ìƒì—ê²Œ ê±´ë„¤ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

    ì§„í–‰ íƒ€ì´ë°ì€ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤.

í•œë²ˆ í™•ì¸í•´ë³´ì

`ë™ê¸°`

```js
var fs = require("fs");

//readFileSync
console.log("A");
var result = fs.readFileSync("syntax/sample.txt", "utf8");
console.log(result);
console.log("C");
```

`ë¹„ë™ê¸°`

```js
console.log("A");
fs.readFile("syntax/sample.txt", "utf8", function (err, result) {
  console.log(result);
});
console.log("C");
```

ì—¬ê¸°ì„œ sample.txt ì˜ ë‚´ìš©ì€ "B" ê°’ì´ë‹¤

ì´ë•Œ ê°ê°ì˜ ë™ê¸°ì™€ ë¹„ë™ê¸°ëŠ” ê°ê° ë‹¤ë¥´ê²Œ ì‹¤í–‰ëœë‹¤.

ë™ê¸°ëŠ” A > B > C

ë™ê¸°ëŠ” `readFileSync` ê°€ ëë‚ ë•Œê¹Œì§€ ì½”ë“œë¥¼ ì§„í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.

ëª¨ë“  ì½”ë“œê°€

ë¹„ë™ê¸°ëŠ” A > C > B

- ë™ê¸°ì™€ ë¹„ë™ê¸°ì˜ ì¥ë‹¨ì  ğŸ’¡

  - ë™ê¸°

    - ì¥ì  : ì„¤ê³„ê°€ ë§¤ìš° ê°„ë‹¨í•˜ê³  ì§ê´€ì 

    - ë‹¨ì  : ê²°ê³¼ê°€ ì£¼ì–´ì§ˆ ë•Œê¹Œì§€ ì•„ë¬´ê²ƒë„ ëª»í•˜ê³  ëŒ€ê¸°

  - ë¹„ë™ê¸°

    - ì¥ì  : ìš”ì²­ì— ë”°ë¥¸ ê²°ê³¼ê°€ ë°˜í™˜ë˜ëŠ” ì‹œê°„ ë™ì•ˆ ë‹¤ë¥¸ ì‘ì—…ì„ ìˆ˜í–‰

    - ë‹¨ì  : ë™ê¸°ì‹ë³´ë‹¤ ì„¤ê³„ê°€ ë³µì¡

### callback

```js
fs.readFile("syntax/sample.txt", "utf8", function (err, result) {
  console.log(result);
});
```

ì—¬ê¸°ì„œ

```js
function (err, result) {
  console.log(result);
}

```

ìš” ë¶€ë¶„ì´ ì½œë°± ë¶€ë¶„ì„

ì½œë°±ì´ë€ ëŒ€ì—ì¶©

    ë‹¤ë¥¸ ì½”ë“œì˜ ì¸ìë¡œì„œ ë„˜ê²¨ì£¼ëŠ” ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œ

```js
/*
function a(){
  console.log('A');
}
*/
var a = function () {
  console.log("A");
};

function slowfunc(callback) {
  callback();
}

slowfunc(a);
```

js ì—ì„œëŠ” í•¨ìˆ˜ë„ ê°’ìœ¼ë¡œì„œ ë³€ìˆ˜ì— ë‹´ì„ ìˆ˜ë„ ìˆê³  í•´ì„œ

ì´ëŸ°ì‹ìœ¼ë¡œ ì´ìš©ì´ ìŒ‰ ê°€ëŠ¥

## 3.2 Node.js - íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì™€ PM2

í˜¼ìì„œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë§Œë“œëŠ” ì¼ì€ ê±°ì˜ ì—†ë‹¤.

íƒ€ì¸ì˜ ëª¨ë“ˆì„ ì´ìš©í•´ì„œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë§Œë“¤ê²Œ ë©ë‹¤.

    ì´ ë•Œ ì‚¬ìš©í•˜ëŠ” ëª¨ë“ˆì´ ë§ì•„ì§€ë©´ ì—¬ëŸ¬ê°€ì§€ ë³µì¡í•œ ë¬¸ì œê°€ ìƒê²¨

    ì´ë¥¼ ê´€ë¦¬í•˜ëŠ” ë„êµ¬ê°€ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë‹¤.

ì†Œí”„íŠ¸ì›¨ì–´ë“¤ì„ ê´€ë¦¬í•´ì£¼ê³ , ìƒì„±í•˜ê³ , ì„¤ì¹˜, ì—…ë°ì´íŠ¸, ì‚­ì œë¥¼ í•´ì£¼ëŠ” í”„ë¡œê·¸ë¨

ì´ë²ˆì—ëŠ” ëŒ€í‘œì ì¸ íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ì¸ NPMì„ ì‚¬ìš©í•˜ëŠ” ë²•ì„ ì‚´í´ë³´ì

ë˜ ì‹¤í–‰ì¤‘ì¸ Node.js ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê´€ë¦¬í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ ë§¤ë‹ˆì € PM2ì˜ ì‚¬ìš©ë²•ë„ ì•Œì•„ë³´ì

```
npm install pm2 -g
```

ì´ëŸ¼ ì„¤ì¹˜ ë

ê·¸ë¦¬ê³  ì‹œì‘í•˜ë ¤ë©´

```
pm2 start name.js
```

ì´ëŸ¼ ë”± ëœ¸

## 3.3 App - ê¸€ìƒì„± UI ë§Œë“¤ê¸°

form ì„ ì´ìš©í•´ì„œ post ë°©ì‹ìœ¼ë¡œ ê¸€ ìƒì„±ì„ êµ¬í˜„í•´ë³´ìì‰

```js
// .... ìƒëµ

else if (pathname === "/create") {
    fs.readdir("./data", function (error, filelist) {
      var title = "WEB - create";
      var list = templateList(filelist);
      var template = templateHTML(
        title,
        list,
        `
          <form action="http://localhost:3000/create_process" method="post">
            <p><input type="text" name="title" placeholder="title"></p>
            <p>
              <textarea name="description" placeholder="description"></textarea>
            </p>
            <p>
              <input type="submit">
            </p>
          </form>
        `
      );
      response.writeHead(200);
      response.end(template);
    });
  } else {
    response.writeHead(404);
    response.end("Not found");
  }
});
app.listen(3000);
```

ì´ëŸ¼ ë¨ ë³„ê±° ì—†ìŒ

## 3.4 App - POST ì „ì†¡ëœ ë°ì´í„° ë°›ê¸°

```js
<form action="http://localhost:3000/create_process" method="post">
```

ìœ„ì—ì„œ create_process ë¡œ ê°”ìœ¼ë‹ˆê¹Œ ê·¸ê±° ê·¸ëŒ€ë¡œ

```js
// .... ìƒëµ

else if(pathname === '/create_process'){
      var body = '';
      request.on('data', function(data){
          body = body + data;
      });
      request.on('end', function(){
          var post = qs.parse(body);
          var title = post.title;
          var description = post.description
      });
      response.writeHead(200);
      response.end('success');
    } else {
      response.writeHead(404);
      response.end('Not found');
    }
```

## 3.5 App - íŒŒì¼ìƒì„±ê³¼ ë¦¬ë‹¤ì´ë ‰ì…˜

ì „ì†¡ëœ POST ë°ì´í„°ë¥¼ ë°›ì•„ì„œ íŒŒì¼ì— ì €ì¥í•˜ê³ , ê·¸ ê²°ê³¼ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜í•˜ëŠ” ë°©ë²•

```js
else if(pathname === '/create_process'){
      var body = '';
      request.on('data', function(data){
          body = body + data;
      });
      request.on('end', function(){
          var post = qs.parse(body);
          var title = post.title;
          var description = post.description;
          fs.writeFile(`data/${title}`, description, 'utf8', function(err){
            response.writeHead(302, {Location: `/?id=${title}`});
            response.end();
          })
      });
```

```js
fs.writeFile(`data/${title}`, description, "utf8", function () {
  // ~~~~
});
```

ì´ëŸ¬ë©´ ë”± íŒŒì¼ì´ ì‘ì„±ì´ ë¨

ì—¬ê¸°ì„œ ë‹¨ìˆœíˆ ëë‚´ë©´ ê¸€ì„ create í•˜ê³  ê·¸ëƒ¥ ëë‚˜ë²„ë¦¼

í•´ë‹¹ ê¸€ë¡œ ê°€ëŠ”ê²Œ ì¢‹ê² ì§€

```js
function(err){
  response.writeHead(302, {Location: `/?id=${title}`});
  response.end();
}
```

ì´ê²Œ ë¦¬ë‹¤ì´ë ‰ì…˜ì„

ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ë³´ë‚´ë²„ë¦¬ëŠ”ê±°

    ë¦¬ë‹¤ì´ë ‰ì…˜ì´ë€, ì§€ì •í•œ ê³³ìœ¼ë¡œ ë°©í–¥ì„ ë°”ê¾¸ëŠ” ê²ƒ
