## 6.11 Our First Query

ìŠ¬ìŠ¬ importê°€ ë§ì•„ì§€ë‹ˆ ë”°ë¡œ ëª¨ì•„ ì •ë¦¬í•˜ë„ë¡ í•˜ì

`server.js`ëŠ” express ëœ ê²ƒë“¤ê³¼ server êµ¬ì„±ì— ê´€ë ¨ëœ ì½”ë“œë“¤ë§Œ

DBë‚˜ model ê°™ì€ ê²ƒë“¤ì€ ë”°ë¡œ ë¹¼ì•¼í•¨

`server.js`

```js
import express from "express";
import morgan from "morgan";

import globalRouter from "./routers/globalRouter";
import videoRouter from "./routers/videoRouter";
import userRouter from "./routers/userRouter";

const app = express();
const logger = morgan("dev");

app.set("view engine", "pug");
app.set("views", process.cwd() + "/src/views");
app.use(logger);
app.use(express.urlencoded({ extended: true }));
app.use("/", globalRouter);
app.use("/videos", videoRouter);
app.use("/users", userRouter);

export default app;
```

`init.js`

```js
import "./db";
import "./models/Video";
import app from "./server";

const PORT = 4000;

const handleListening = () =>
  console.log(`âœ… Server listenting on port http://localhost:${PORT} ğŸš€`);

app.listen(PORT, handleListening);
```

`package.json`

```json
  "scripts": {
    "dev": "nodemon --exec babel-node src/init.js"
  },
```

ì´ì œ `videoController.js` ì— ì„ì‹œ DB, ê´€ë ¨ ì½”ë“œë¥¼ ì§€ìš°ê³ 

```js
import Video from "../models/Video";
```

modelì„ import í•¨

ê·¸ë¦¬ê³  DBì™€ ì—°ê²°í•˜ë ¤ë©´ `model.find()` ë¥¼ ì‚¬ìš©í•˜ë©´ ë¨

```js
export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    console.log("error : ", error);
    console.log("videos : ", videos);
  });
  return res.render("home", { pageTitle: "Home", videos: [] });
};
```

`model.find()` ë¥¼ ì‚¬ìš©í•˜ëŠ”ë° 2ê°€ì§€ ë°©ë²•ì´ ìˆëŠ”ë°

1.  callback í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•

2.  promise ë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•

## 6.12 Our First Query part Two

    callback í•¨ìˆ˜ëŠ” ë¬´ì–¸ê°€ê°€ ë°œìƒí•˜ê³  ë‚œ ë‹¤ìŒ í˜¸ì¶œë˜ëŠ” function

```js
Video.find({}, (error, videos) => {});
```

mongoose ëŠ” ì´ë¶€ë¶„ì„ DBì—ì„œ ë¶ˆëŸ¬ ì˜¬êº¼ì„

ê·¸ë¦¬ê³  DBê°€ ë°˜ì‘í•˜ë©´ function ì„ ì‹¤í–‰í• êº¼ì„

ê·¸ ë‹¤ìŒì— mongooseëŠ” `error`, `videos` ê°’ì„ ë¶ˆëŸ¬ ì˜¬êº¼ì„

`(error, videos) => {}` ì´ë¶€ë¶„ì€

```js
const handleSearch = (error, videos) => {};
```

ì´ê²ƒê³¼ ê°™ìŒ

home í™”ë©´ìœ¼ë¡œ ê°€ì„œ consol.log ê°’ì„ ë³´ë©´

```
error : null
videos : []
```

ì´ë ‡ê²Œ ë‚˜ì˜´

ì´ì œ

```js
export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    console.log(`error : ${error}`);
    console.log("videos : ", videos);
  });
  console.log("HI");
  return res.render("home", { pageTitle: "Home", videos });
};
```

ì´ë ‡ê²Œ í•˜ê³  ì‹¤í–‰í•´ë³´ë©´

```
HI
GET / 304 232.326 ms - -
error : null
videos : []
```

ì´ë ‡ê²Œ ë‚˜ì˜´

`HI` ì¶œë ¥ë³´ë‹¤ `error`,`videos` ì¶œë ¥ì´ ë” ëŠ¦ê²Œë¨

ì´ê²Œ `callback` í•¨ìˆ˜ì„

**ì½”ë“œì— ë”°ë¼ ì‹¤í–‰ë˜ëŠ” ì‹œê°„ì´ ë‹¤ë¦„**

ì´ê²ƒì„ ì´ìš©í•´ì„œ

```js
export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    return res.render("home", { pageTitle: "Home", videos });
  });
};
```

ë§ˆì§€ë§‰ì— render í•  ìˆ˜ ìˆê²Œ

ê·¼ë° ë‹¤ì†Œ ë³µì¡í•¨

ê·¸ë˜ì„œ ì´ë²ˆì—ëŠ” ë‘ë²ˆì§¸ ë°©ë²•ì„ ì¨ë³¼êº¼ì„

## 6.13 Async Await

`callback` ì˜ ì¥ì ì€ ì—ëŸ¬ë“¤ì„ ë°”ë¡œ ì—¬ê¸°ì—ì„œ ë³¼ ìˆ˜ ìˆë‹¤ëŠ” ê±°ì„

ì¶”ê°€ì ì¸ ì½”ë“œì—†ì´ë„ ì—ëŸ¬ë“¤ì„ ë°”ë¡œ ë³¼ ìˆ˜ ìˆìŒ

```js
export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    if (error) {
      return res.render(`server-error ${error}`);
    }
    return res.render("home", { pageTitle: "Home", videos });
  });
};
```

`promise` ëŠ” `callback` í•¨ìˆ˜ì˜ ìµœì‹  ë²„ì „ì´ë¼ê³  ìƒê°í•˜ë©´ ë¨

```js
export const home = async (req, res) => {
  const videos = await Video.find({});
  return res.render("home", { pageTitle: "Home", videos });
};
```

`await` ë¥¼ find ì•ì— ì ìœ¼ë©´

findëŠ” ë‹ˆê°€ callbackì„ í•„ìš”ë¡œ í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê±¸ ì•Œê²Œ ë¨

ê·¸ë ‡ê¸°ì— findëŠ” ì°¾ì•„ë‚¸ ë¹„ë””ì˜¤ë¥¼ ë°”ë¡œ ì¶œë ¥í•´ì¤Œ

```js
export const home = async (req, res) => {
  console.log("start");
  const videos = await Video.find({});
  console.log(videos);
  console.log("finish");
  return res.render("home", { pageTitle: "Home", videos: [] });
};
```

```
start
[]
finish
GET / 304 209.843 ms - -
```

ë³´ë©´ ë°”ë¡œ ì¶œë ¥ì„ í•´ì¤Œ

`await` ê°€ ì¢‹ì€ ì´ìœ ê°€ DBì—ì„œ ê°’ì„ ë°›ì„ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤€ë‹¤ëŠ”ê±°ì„

`callback` ë¥¼ ì“°ë©´ ë¶€ë¥´ëŠ” ë™ì•ˆ ì•„ë˜ì˜ ì½”ë“œê°€ ì‹¤í–‰ë˜ì–´

ì‹¤í–‰ìˆœì„œê°€ ë‹¬ë¼ì§€ëŠ” ì¼ì´ ìƒê¸°ëŠ”ë°

`await`ë¥¼ ì“°ê²Œ ë˜ë©´ ê·¸ëŸ°ì¼ì´ ì—†ì–´ì§€ë‹¤~

ê·¸ë˜ì„œ ì§ê´€ì ì´ê³  ì¡°íƒ€~

<br>

ê·¸ëŸ¼ `error`ëŠ” ì–´ë–»ê²Œ í•˜ëƒ?

```js
export const home = async (req, res) => {
  try {
    const videos = await Video.find({});
    return res.render("home", { pageTitle: "Home", videos });
  } catch {
    return res.render("server-error");
  }
};
```

íŠ¸ë¼ì´ ìºì¹˜ë¬¸ì„ ì“°ì~

ì½”ë”© ê·œì¹™ìƒ `await`ëŠ” function ì•ˆì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ê³ 

í•´ë‹¹ function ì— `async`(asynchronous)ë¥¼ ì ì–´ì•¼í•¨

<br><br>

## 6.14 Returns and Renders

ì‚¬ì‹¤ callback í•¨ìˆ˜ì—ì„œ í‹€ë¦°ê²Œ

```js
export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    return res.render("home", { pageTitle: "Home", videos });
  });
};
```

find í•¨ìˆ˜ ë‚´ì— `return` ì„ ì‚¬ìš©í•˜ê³  ìˆìŒ

ì´ëŸ¬ë©´ find í•¨ìˆ˜ì˜ return ì´ì§€ home í•¨ìˆ˜ì˜ returnì´ ì•„ë‹˜

home ì–´ë–¤ê²ƒë„ return í•˜ì§€ ì•Šê³  ìˆëŠ” ê±°ì„

ë˜ ì‚¬ì‹¤ returnëŠ” ì¤‘ìš”ì¹˜ ì•ŠìŒ

```js
export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    res.render("home", { pageTitle: "Home", videos });
  });
};
```

return ì„ ë¹¼ê³  `render` ë§Œ ì ì–´ë†”ë„ ì‘ë™í•˜ëŠ” ë°ì— ì „í˜€ ë¬¸ì œê°€ ì—†ìŒ

ì¤‘ìš”í•œê±´ `render`ë¥¼ ì‹¤í–‰í–ˆë‹¤ëŠ” ê²ƒê³¼ **í•œë²ˆë§Œ** ì‹¤í–‰í–ˆë‹¤ëŠ” ê±°ì„

```js
export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    res.render("home", { pageTitle: "Home", videos });
    res.render("home", { pageTitle: "Home", videos });
  });
};
```

ì´ë ‡ê²Œ í–ˆë‹¤ë©´ ì˜¤ë¥˜ê°€ ëœ¸

ì´ë¯¸ render í•œ ê²ƒì€ ë‹¤ì‹œ render í•  ìˆ˜ ì—†ìŒ

`return` ì„ ì¨ì£¼ëŠ” ì´ìœ ëŠ”

    í•´ë‹¹ functiondì´ render ì‘ì—… í›„ì— ì¢…ë£Œë˜ë„ë¡ í•˜ê¸° ìœ„í•´ì„œ

ë§Œì•½

```js
export const home = (req, res) => {
  Video.find({}, (error, videos) => {
    return res.render("home", { pageTitle: "Home", videos });
  });
  return res.end();
};
```

ì´ë ‡ê²Œ í•œë‹¤ë©´ `find()` í•¨ìˆ˜ë¥¼ ë¶ˆëŸ¬ë‚´ê¸° ì „ì— res.end()ë¡œ ì—°ê²°ì„ ëŠê³  home í•¨ìˆ˜ë¥¼ ì¢…ë£Œ í•´ë²„ë¦¼
