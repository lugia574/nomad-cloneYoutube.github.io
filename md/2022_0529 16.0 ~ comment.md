# 16 COMMENT SECTION

## 16.0 Introduction

이제 댓글창을 만들꺼임

이전까지 했던걸 전반적으로 다시 해보는 시간이 될꺼임

## 16.1 Comment Models

제일 먼저 해야할껀 데이터 모델. Schema를 만들자

`models/Comment.js`

```js
import mongoose from "mongoose";

const commentSchema = new mongoose.Schema({
  Text: { type: String, required: true },
  owner: { type: mongoose.Schema.Types.ObjectId, required: true, ref: "User" },
  video: { type: mongoose.Schema.Types.ObjectId, required: true, ref: "Video" },
  createdAt: { type: Date, required: true, default: Date.now },
});

const Comment = mongoose.model("Comment", commentSchema);
export default Comment;
```

코멘트가 생겨남에 따라 `User`와 `Video` 모델도 이에 맞게 수정

`Video.js` 에 추가

```js
  comment: [
    { type: mongoose.Schema.Types.ObjectId, required: true, ref: "Comment" },
  ],
```

`User.js`에 추가

```js
  comment: [
    { type: mongoose.Schema.Types.ObjectId, ref: "Comment" },
  ],
```

이제 `init.js` 에 import 해주자

```js
import "./models/Comment";
```

Video 모델에서 Comments가 required: true이어야 할 이유가 있을까?

comment가 달리지 않은 video도 있을 수 있는데?

우선 required 없애고 진행 하자

## 16.2 Comment Box

이제 프론트엔드를 만져보자

`/client/js/commentSection.js` 을 만들고

단순히 만들기만 하면 webpack이 이해하지 못함

웹팩에 적어주자

```js
  entry: {
    main: "./src/client/js/main.js",
    videoPlayer: "./src/client/js/videoPlayer.js",
    recorder: "./src/client/js/recorder.js",
    commentSection: "./src/client/js/commentSection.js",
  }
```

./src/client/js/ 라는 동일한 주소를 가지고 있으니까

```js
const BASE_JS = "./src/client/js/";

module.exports = {
  entry: {
    main: BASE_JS + "main.js",
    videoPlayer: BASE_JS + "videoPlayer.js",
    recorder: BASE_JS + "recorder.js",
    commentSection: BASE_JS + "commentSection.js",
  },
};
```

이렇게 쌉가능

이제 이 `commentSection.js` 를 사용할 템플릿에서,

그걸 불러와서 사용

`watch.pug`

```pug
block script
    script(src="/static/js/videoPlayer.js")
    script(src="/static/js/commentSection.js")
```

이제 연결도 했겠다

기본적인 외형을 만들자

```pug

div.video__comments
            form.video__comment-form#commentForm
                textarea(cols="30", rows="10", placeholder="Write a nice commment...")
                button Add Comment
```

그리고 이걸 js에서 받아야함

```js
const form = document.getElementById("commentForm");
const textarea = form.querySelector("textarea");
const btn = form.querySelector("button");
```

버튼을 누르면 댓글에 써진 텍스트를 받아올수 있게 구현 ㄱㄱ

```js
const handleSubmit = () => {};

btn.addEventListener("click", handleSubmit);
```

근데 이렇게하고 값을 받으면 form이 제출되면서 새로고침을 해버림

`click` 이 아니라 `submit`으로 하자

```js
form.addEventListener("submit", handleSubmit);
```

근뎈ㅋ 이렇게 해도 새로고침 됨 ㅋㅋㅋ

기본동작이래 ㅋㅋㅋ

기본 동작을 막으려면

```js
const handleSubmit = () => {
  event.preventDefault();
};
```

이렇게 ㄱㄱ
